import { FixedSizeList, VariableSizeList } from 'react-window';
import { PureComponent, createRef } from 'react';
import { jsx } from 'react/jsx-runtime';

var x=()=>{};var h=(r,e=null)=>({child:null,isShown:e?e.public.isOpen&&e.isShown:!0,parent:e,public:r,sibling:null,visited:!1}),R=(r,{getRecordData:e})=>{let{data:{id:t}}=e(r);return t},L=r=>e=>{r.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e);});};var k=({index:r,data:{component:e,getRecordData:t,treeData:a},style:n,isScrolling:o})=>{let l=t(r);return jsx(e,{isScrolling:o,style:n,treeData:a,...l})},A=({createRecord:r},{buildingTaskTimeout:e,placeholder:t,async:a=!1,treeWalker:n},o)=>{let l=a&&o.records!==void 0,{records:b}=o,c=[],S=new Map,d=e?{timeout:e}:void 0,T=new WeakMap,s=n(),{value:u}=s.next(),p=r(u.data,o,void 0,l?b.get(u.data.id):void 0);S.set(p.public.data.id,p),T.set(p,u);let i=p,N=!0,D=p,z=typeof requestIdleCallback<"u"&&t!==void 0&&!(t===null&&!o.order),v=z?O=>O.timeRemaining()>0:()=>!0,g=O=>{for(;i!==null;){if(!v(O)){requestIdleCallback(g,d);return}if(i.visited)i.visited=!1,i=i.sibling!==null?i.sibling:i.parent,D=i;else {let{value:m}=s.next(T.get(i));if(m===void 0){N?N=!1:(i.isShown&&c.push(i.public.data.id),i.visited=i.child!==null,i=i.child!==null?i.child:i.sibling!==null?i.sibling:i.parent),D=i;continue}let P=r(m.data,o,N?void 0:i,l?b.get(m.data.id):void 0);S.set(P.public.data.id,P),T.set(P,m),!N&&D===i?D.child=P:D.sibling=P,D=P;}}z&&o.setState({order:c,records:S,updateRequest:{}});};return z?requestIdleCallback(g,d):g(),t!==void 0&&a&&o.order?o:{order:c,records:S}},F=32768,M=2,q=({order:r,records:e},{opennessState:t})=>{if(typeof t!="object")return null;for(let a in t){if(!e.has(a))continue;let n=t[a],o=e.get(a),{open:l,subtreeCallback:b=x}=typeof n=="boolean"?{open:n}:n,c=x,S=x;if(o.isShown){if(l){let T=r.indexOf(a),s=o;for(;s!==null;){if(s.sibling!==null){s=s.sibling;break}s=s.parent;}let u=s===null?r.length-1-T:r.indexOf(s.public.data.id)-1-T,p=[[T+1,u]];c=i=>{if(i.isShown=i.parent?i.parent.public.isOpen&&i.parent.isShown:!0,i.isShown){let N=p[p.length-1];N.push(i.public.data.id),N.length===F+M&&p.push([T+1+F*p.length,0]);}},S=()=>{for(let i=0;i<p.length;i++)r.splice(...p[i]);};}else if(o.public.isOpen){let T=r.indexOf(a),s=0;c=u=>{u.isShown&&(s+=1),u.isShown=u.parent?u.parent.public.isOpen&&u.parent.isShown:!0;},S=()=>{r.splice(T+1,s);};}}let d=o;for(;d!==null;)d.visited?(d.visited=!1,d=d===o?null:d.sibling!==null?d.sibling:d.parent):(d.public.isOpen=d===o?l:d.public.isOpen,b(d.public,o.public),d!==o&&c(d),d.visited=d.child!==null,d=d.child!==null?d.child:d===o?null:d.sibling!==null?d.sibling:d.parent);S();}return {order:r,records:e,updateRequest:{}}},y=r=>(e,t,a)=>a.refresh?A(r,e,t):q(t,a),f=class extends PureComponent{static getDerivedStateFromProps(e,t){let{listRef:a=null,treeWalker:n}=e,{computeTree:o,list:l,order:b,treeWalker:c}=t;return {attachRefs:L([l,a]),...n!==c||!b?o(e,t,{refresh:!0}):null,treeWalker:n}}constructor(e,t){super(e,t),this.getRecordData=this.getRecordData.bind(this),this.state={list:createRef(),recomputeTree:this.recomputeTree.bind(this),setState:this.setState.bind(this)};}getItemData(){let{children:e,itemData:t}=this.props;return {component:e,getRecordData:this.getRecordData,treeData:t}}getRecordData(e){let{order:t,records:a}=this.state;return a.get(t[e]).public}recomputeTree(e){return new Promise(t=>{this.setState(a=>a.computeTree(this.props,a,{opennessState:e}),t);})}scrollTo(e){var t;(t=this.state.list.current)==null||t.scrollTo(e);}scrollToItem(e,t){var a;(a=this.state.list.current)==null||a.scrollToItem(this.state.order.indexOf(e),t);}};f.defaultProps={rowComponent:k};var C=f;var E=y({createRecord:(r,{recomputeTree:e},t,a)=>h({data:r,isOpen:a?a.public.isOpen:r.isOpenByDefault,setOpen:n=>e({[r.id]:n})},t)}),V=class extends C{constructor(e,t){super(e,t),this.state={...this.state,computeTree:E};}render(){let{placeholder:e,rowComponent:t,...a}=this.props,{attachRefs:n,order:o}=this.state;return e&&o.length===0?e:jsx(FixedSizeList,{...a,itemCount:o.length,itemData:this.getItemData(),itemKey:R,ref:n,children:t})}};var G=y({createRecord:(r,{recomputeTree:e,resetAfterId:t},a,n)=>{let o=h({data:r,height:n?n.public.height:r.defaultHeight,isOpen:n?n.public.isOpen:r.isOpenByDefault,resize:(l,b)=>{o.public.height=l,t(o.public.data.id,b);},setOpen:l=>e({[r.id]:l})},a);return o}}),I=class extends C{constructor(e,t){super(e,t),this.getItemSize=this.getItemSize.bind(this),this.state={...this.state,computeTree:G,resetAfterId:this.resetAfterId.bind(this)};}resetAfterId(e,t=!1){var o;let{list:a,order:n}=this.state;(o=a.current)==null||o.resetAfterIndex(n.indexOf(e),t);}recomputeTree(e){return super.recomputeTree(e).then(()=>{var t;(t=this.state.list.current)==null||t.resetAfterIndex(0,!0);})}render(){let{placeholder:e,itemSize:t,rowComponent:a,...n}=this.props,{attachRefs:o,order:l}=this.state;return e&&l.length===0?e:jsx(VariableSizeList,{...n,itemCount:l.length,itemData:this.getItemData(),itemKey:R,itemSize:t??this.getItemSize,ref:o,children:a})}getItemSize(e){return this.getRecordData(e).height}};

export { V as FixedSizeTree, k as Row, I as VariableSizeTree };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9GaXhlZFNpemVUcmVlLnRzeCIsIi4uL3NyYy9UcmVlLnRzeCIsIi4uL3NyYy91dGlscy50cyIsIi4uL3NyYy9WYXJpYWJsZVNpemVUcmVlLnRzeCJdLCJuYW1lcyI6WyJGaXhlZFNpemVMaXN0IiwiY3JlYXRlUmVmIiwiUHVyZUNvbXBvbmVudCIsIm5vb3AiLCJjcmVhdGVCYXNpY1JlY29yZCIsInB1YiIsInBhcmVudCIsImdldElkQnlJbmRleCIsImluZGV4IiwiZ2V0UmVjb3JkRGF0YSIsImlkIiwibWVyZ2VSZWZzIiwicmVmcyIsInZhbHVlIiwicmVmIiwianN4IiwiUm93IiwiTm9kZSIsInRyZWVEYXRhIiwic3R5bGUiLCJpc1Njcm9sbGluZyIsImRhdGEiLCJnZW5lcmF0ZU5ld1RyZWUiLCJjcmVhdGVSZWNvcmQiLCJidWlsZGluZ1Rhc2tUaW1lb3V0IiwicGxhY2Vob2xkZXIiLCJhc3luYyIsInRyZWVXYWxrZXIiLCJzdGF0ZSIsInNob3VsZFByZXNlcnZlUHJldmlvdXNTdGF0ZSIsInByZXZpb3VzUmVjb3JkcyIsIm9yZGVyIiwicmVjb3JkcyIsInJlcXVlc3RJZGxlQ2FsbGJhY2tPcHRpb25zIiwibWV0YSIsIml0ZXIiLCJyb290Iiwicm9vdFJlY29yZCIsImN1cnJlbnRSZWNvcmQiLCJpc1RyYXZlcnNpbmdSb290IiwidGVtcFJlY29yZCIsInVzZUlkbGVDYWxsYmFjayIsImhhc1RpbWUiLCJkZWFkbGluZSIsInRhc2siLCJjaGlsZCIsImNoaWxkUmVjb3JkIiwiTUFYX0ZVTkNUSU9OX0FSR1VNRU5UUyIsIlNQTElDRV9ERUZBVUxUX0FSR1VNRU5UU19OVU1CRVIiLCJ1cGRhdGVFeGlzdGluZ1RyZWUiLCJvcGVubmVzc1N0YXRlIiwib3B0cyIsIm93bmVyUmVjb3JkIiwib3BlbiIsInN1YnRyZWVDYWxsYmFjayIsInVwZGF0ZSIsImFwcGx5IiwicmVjb3JkTmV4dFRvU3VidHJlZSIsImNvdW50VG9SZW1vdmUiLCJvcmRlclBhcnRzIiwicmVjb3JkIiwiY3VycmVudE9yZGVyUGFydCIsImNvdW50IiwiY3JlYXRlVHJlZUNvbXB1dGVyIiwiY3JlYXRvck9wdGlvbnMiLCJwcm9wcyIsIm9wdGlvbnMiLCJUcmVlIiwibGlzdFJlZiIsImNvbXB1dGVUcmVlIiwibGlzdCIsIm9sZFRyZWVXYWxrZXIiLCJjb250ZXh0IiwiY29tcG9uZW50IiwicmVzb2x2ZSIsInByZXZTdGF0ZSIsInNjcm9sbE9mZnNldCIsIl9hIiwiYWxpZ24iLCJUcmVlX2RlZmF1bHQiLCJyZWNvbXB1dGVUcmVlIiwicHJldmlvdXNSZWNvcmQiLCJGaXhlZFNpemVUcmVlIiwicm93Q29tcG9uZW50IiwicmVzdCIsImF0dGFjaFJlZnMiLCJWYXJpYWJsZVNpemVMaXN0IiwicmVzZXRBZnRlcklkIiwiaGVpZ2h0Iiwic2hvdWxkRm9yY2VVcGRhdGUiLCJWYXJpYWJsZVNpemVUcmVlIiwiaXRlbVNpemUiXSwibWFwcGluZ3MiOiJBQUNBLE9BQVMsaUJBQUFBLE1BQXlDLGVDQ2xELE9BR0UsYUFBQUMsRUFFQSxpQkFBQUMsTUFNSyxRQ2lDQSxJQUFNQyxFQUFPLElBQVksQ0FBQyxFQUkxQixJQUFNQyxFQUFvQixDQUkvQkMsRUFDQUMsRUFBOEMsUUFDWixDQUNsQyxNQUFPLEtBQ1AsUUFBU0EsRUFBU0EsRUFBTyxPQUFPLFFBQVVBLEVBQU8sUUFBVSxHQUMzRCxPQUFBQSxFQUNBLE9BQVFELEVBQ1IsUUFBUyxLQUNULFFBQVMsRUFDWCxHQUVhRSxFQUFlLENBSTFCQyxFQUNBLENBQUUsY0FBQUMsQ0FBYyxJQUNMLENBQ1gsR0FBTSxDQUNKLEtBQU0sQ0FBRSxHQUFBQyxDQUFHLENBQ2IsRUFBSUQsRUFBY0QsQ0FBSyxFQUV2QixPQUFPRSxDQUNULEVBRWFDLEVBRVRDLEdBRURDLEdBQVUsQ0FDVEQsRUFBSyxRQUFTRSxHQUFRLENBQ2hCLE9BQU9BLEdBQVEsV0FDakJBLEVBQUlELENBQUssRUFDQUMsR0FBTyxPQUVmQSxFQUF5QyxRQUFVRCxFQUV4RCxDQUFDLENBQ0gsRUR3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QUFMLE1BQUFPLEVBQWMsZ0JBQWdCOUMsRUFBTyxRQUFRckIsQ0FBRSxFQUFHK0UsRUFDcEQsQ0FFTyxjQUNMN0QsRUFDZSxDQUNmLE9BQU8sTUFBTSxjQUFjQSxDQUFLLEVBQUUsS0FBSyxJQUFNLENBckdqRCxJQUFBaUQsR0FzR01BLEVBQUEsS0FBSyxNQUFNLEtBQUssVUFBaEIsTUFBQUEsRUFBeUIsZ0JBQWdCLEVBQUcsR0FDOUMsQ0FBQyxDQUNILENBRU8sUUFBb0IsQ0FDekIsR0FBTSxDQUFFLFlBQUFwRCxFQUFhLFNBQUFrRSxFQUFVLGFBQUFSLEVBQWMsR0FBR0MsQ0FBSyxFQUFJLEtBQUssTUFDeEQsQ0FBRSxXQUFBQyxFQUFZLE1BQUF0RCxDQUFNLEVBQUksS0FBSyxNQUVuQyxPQUFPTixHQUFlTSxFQUFPLFNBQVcsRUFDdENOLEVBRUFWLEVBQUN1RSxFQUFBLENBQ0UsR0FBR0YsRUFDSixVQUFXckQsRUFBTyxPQUNsQixTQUFVLEtBQUssWUFBWSxFQUUzQixRQUFTeEIsRUFFVCxTQUFVb0YsR0FBWSxLQUFLLFlBRTNCLElBQUtOLEVBRUosU0FBQUYsRUFDSCxDQUVKLENBRVEsWUFBWTNFLEVBQXVCLENBQ3pDLE9BQU8sS0FBSyxjQUFjQSxDQUFLLEVBQUUsTUFDbkMsQ0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7IEZpeGVkU2l6ZUxpc3QsIEZpeGVkU2l6ZUxpc3RQcm9wcyB9IGZyb20gJ3JlYWN0LXdpbmRvdyc7XHJcbmltcG9ydCBUcmVlLCB7XHJcbiAgY3JlYXRlVHJlZUNvbXB1dGVyLFxyXG4gIE5vZGVEYXRhLFxyXG4gIE5vZGVQdWJsaWNTdGF0ZSxcclxuICBUcmVlUHJvcHMsXHJcbiAgVHJlZVN0YXRlLFxyXG59IGZyb20gJy4vVHJlZSc7XHJcbmltcG9ydCB7IGNyZWF0ZUJhc2ljUmVjb3JkLCBnZXRJZEJ5SW5kZXggfSBmcm9tICcuL3V0aWxzJztcclxuXHJcbmV4cG9ydCB0eXBlIEZpeGVkU2l6ZU5vZGVEYXRhID0gTm9kZURhdGE7XHJcblxyXG5leHBvcnQgdHlwZSBGaXhlZFNpemVOb2RlUHVibGljU3RhdGU8VERhdGEgZXh0ZW5kcyBGaXhlZFNpemVOb2RlRGF0YT4gPVxyXG4gIE5vZGVQdWJsaWNTdGF0ZTxURGF0YT47XHJcblxyXG5leHBvcnQgdHlwZSBGaXhlZFNpemVUcmVlUHJvcHM8VERhdGEgZXh0ZW5kcyBGaXhlZFNpemVOb2RlRGF0YT4gPSBUcmVlUHJvcHM8XHJcbiAgVERhdGEsXHJcbiAgRml4ZWRTaXplTm9kZVB1YmxpY1N0YXRlPFREYXRhPixcclxuICBGaXhlZFNpemVMaXN0XHJcbj4gJlxyXG4gIFJlYWRvbmx5PFBpY2s8Rml4ZWRTaXplTGlzdFByb3BzLCAnaXRlbVNpemUnPj47XHJcblxyXG5leHBvcnQgdHlwZSBGaXhlZFNpemVUcmVlU3RhdGU8VERhdGEgZXh0ZW5kcyBGaXhlZFNpemVOb2RlRGF0YT4gPSBUcmVlU3RhdGU8XHJcbiAgVERhdGEsXHJcbiAgRml4ZWRTaXplTm9kZVB1YmxpY1N0YXRlPFREYXRhPixcclxuICBGaXhlZFNpemVMaXN0XHJcbj47XHJcblxyXG5jb25zdCBjb21wdXRlVHJlZSA9IGNyZWF0ZVRyZWVDb21wdXRlcjxcclxuICBGaXhlZFNpemVOb2RlRGF0YSxcclxuICBGaXhlZFNpemVOb2RlUHVibGljU3RhdGU8Rml4ZWRTaXplTm9kZURhdGE+LFxyXG4gIEZpeGVkU2l6ZVRyZWVQcm9wczxGaXhlZFNpemVOb2RlRGF0YT4sXHJcbiAgRml4ZWRTaXplVHJlZVN0YXRlPEZpeGVkU2l6ZU5vZGVEYXRhPlxyXG4+KHtcclxuICBjcmVhdGVSZWNvcmQ6IChkYXRhLCB7IHJlY29tcHV0ZVRyZWUgfSwgcGFyZW50LCBwcmV2aW91c1JlY29yZCkgPT5cclxuICAgIGNyZWF0ZUJhc2ljUmVjb3JkKFxyXG4gICAgICB7XHJcbiAgICAgICAgZGF0YSxcclxuICAgICAgICBpc09wZW46IHByZXZpb3VzUmVjb3JkXHJcbiAgICAgICAgICA/IHByZXZpb3VzUmVjb3JkLnB1YmxpYy5pc09wZW5cclxuICAgICAgICAgIDogZGF0YS5pc09wZW5CeURlZmF1bHQsXHJcbiAgICAgICAgc2V0T3BlbjogKHN0YXRlKTogUHJvbWlzZTx2b2lkPiA9PlxyXG4gICAgICAgICAgcmVjb21wdXRlVHJlZSh7XHJcbiAgICAgICAgICAgIFtkYXRhLmlkXTogc3RhdGUsXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgfSxcclxuICAgICAgcGFyZW50XHJcbiAgICApLFxyXG59KTtcclxuXHJcbmV4cG9ydCBjbGFzcyBGaXhlZFNpemVUcmVlPFxyXG4gIFREYXRhIGV4dGVuZHMgRml4ZWRTaXplTm9kZURhdGEgPSBGaXhlZFNpemVOb2RlRGF0YVxyXG4+IGV4dGVuZHMgVHJlZTxcclxuICBURGF0YSxcclxuICBGaXhlZFNpemVOb2RlUHVibGljU3RhdGU8VERhdGE+LFxyXG4gIEZpeGVkU2l6ZVRyZWVQcm9wczxURGF0YT4sXHJcbiAgRml4ZWRTaXplVHJlZVN0YXRlPFREYXRhPixcclxuICBGaXhlZFNpemVMaXN0XHJcbj4ge1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcm9wczogRml4ZWRTaXplVHJlZVByb3BzPFREYXRhPiwgY29udGV4dDogYW55KSB7XHJcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XHJcblxyXG4gICAgdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgLi4udGhpcy5zdGF0ZSxcclxuICAgICAgY29tcHV0ZVRyZWUsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlbmRlcigpOiBSZWFjdE5vZGUge1xyXG4gICAgY29uc3QgeyBwbGFjZWhvbGRlciwgcm93Q29tcG9uZW50LCAuLi5yZXN0IH0gPSB0aGlzLnByb3BzO1xyXG5cclxuICAgIGNvbnN0IHsgYXR0YWNoUmVmcywgb3JkZXIgfSA9IHRoaXMuc3RhdGU7XHJcblxyXG4gICAgcmV0dXJuIHBsYWNlaG9sZGVyICYmIG9yZGVyIS5sZW5ndGggPT09IDAgPyAoXHJcbiAgICAgIHBsYWNlaG9sZGVyXHJcbiAgICApIDogKFxyXG4gICAgICA8Rml4ZWRTaXplTGlzdFxyXG4gICAgICAgIHsuLi5yZXN0fVxyXG4gICAgICAgIGl0ZW1Db3VudD17b3JkZXIhLmxlbmd0aH1cclxuICAgICAgICBpdGVtRGF0YT17dGhpcy5nZXRJdGVtRGF0YSgpfVxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvdW5ib3VuZC1tZXRob2RcclxuICAgICAgICBpdGVtS2V5PXtnZXRJZEJ5SW5kZXh9XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC91bmJvdW5kLW1ldGhvZFxyXG4gICAgICAgIHJlZj17YXR0YWNoUmVmc31cclxuICAgICAgPlxyXG4gICAgICAgIHtyb3dDb21wb25lbnQhfVxyXG4gICAgICA8L0ZpeGVkU2l6ZUxpc3Q+XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iLCIvKiBlc2xpbnQtZGlzYWJsZSByZWFjdC9uby11bnVzZWQtY2xhc3MtY29tcG9uZW50LW1ldGhvZHMgKi9cclxuLyogZXNsaW50LWRpc2FibGUgbm8tbGFiZWxzLG1heC1kZXB0aCxjb21wbGV4aXR5ICovXHJcbmltcG9ydCBSZWFjdCwge1xyXG4gIENvbXBvbmVudCxcclxuICBDb21wb25lbnRUeXBlLFxyXG4gIGNyZWF0ZVJlZixcclxuICBQcm9wc1dpdGhDaGlsZHJlbixcclxuICBQdXJlQ29tcG9uZW50LFxyXG4gIFJlYWN0RWxlbWVudCxcclxuICBSZWFjdE5vZGUsXHJcbiAgUmVmLFxyXG4gIFJlZkNhbGxiYWNrLFxyXG4gIFJlZk9iamVjdCxcclxufSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7XHJcbiAgQWxpZ24sXHJcbiAgRml4ZWRTaXplTGlzdCxcclxuICBMaXN0Q2hpbGRDb21wb25lbnRQcm9wcyxcclxuICBMaXN0UHJvcHMsXHJcbiAgVmFyaWFibGVTaXplTGlzdCxcclxufSBmcm9tICdyZWFjdC13aW5kb3cnO1xyXG5pbXBvcnQge1xyXG4gIERlZmF1bHRUcmVlUHJvcHMsXHJcbiAgRGVmYXVsdFRyZWVTdGF0ZSxcclxuICBtZXJnZVJlZnMsXHJcbiAgbm9vcCxcclxuICBSZXF1ZXN0SWRsZUNhbGxiYWNrRGVhZGxpbmUsXHJcbn0gZnJvbSAnLi91dGlscyc7XHJcblxyXG5leHBvcnQgdHlwZSBOb2RlRGF0YSA9IFJlYWRvbmx5PHtcclxuICAvKipcclxuICAgKiBVbmlxdWUgSUQgb2YgdGhlIGN1cnJlbnQgbm9kZS5cclxuICAgKi9cclxuICBpZDogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiBEZWZhdWx0IG5vZGUgb3Blbm5lc3Mgc3RhdGUuIElmIHRoZSBUcmVlIGNvbXBvbmVudCBwZXJmb3JtcyBidWlsZGluZyBhIG5ld1xyXG4gICAqIFRyZWUgYW5kIHRoZSBwcmVzZXJ2ZVByZXZpb3VzU3RhdGUgcHJvcCBpcyBub3Qgc2V0LCB0aGlzIHZhbHVlIHdpbGwgYmUgdXNlZFxyXG4gICAqIHRvIHNldCB0aGUgb3Blbm5lc3Mgc3RhdGUgb2YgdGhlIG5vZGUuXHJcbiAgICovXHJcbiAgaXNPcGVuQnlEZWZhdWx0OiBib29sZWFuO1xyXG59PjtcclxuXHJcbmV4cG9ydCB0eXBlIFRyZWVXYWxrZXJWYWx1ZTxURGF0YSBleHRlbmRzIE5vZGVEYXRhLCBUTWV0YSA9IHt9PiA9IFJlYWRvbmx5PFxyXG4gIHsgZGF0YTogVERhdGEgfSAmIFRNZXRhXHJcbj47XHJcblxyXG5leHBvcnQgdHlwZSBPcGVubmVzc1N0YXRlVXBkYXRlUnVsZXM8XHJcbiAgVERhdGEgZXh0ZW5kcyBOb2RlRGF0YSxcclxuICBUTm9kZVB1YmxpY1N0YXRlIGV4dGVuZHMgTm9kZVB1YmxpY1N0YXRlPFREYXRhPlxyXG4+ID0gUmVhZG9ubHk8e1xyXG4gIG9wZW46IGJvb2xlYW47XHJcbiAgc3VidHJlZUNhbGxiYWNrPzogKFxyXG4gICAgbm9kZTogVE5vZGVQdWJsaWNTdGF0ZSxcclxuICAgIG93bmVyTm9kZTogVE5vZGVQdWJsaWNTdGF0ZVxyXG4gICkgPT4gdm9pZDtcclxufT47XHJcblxyXG5leHBvcnQgdHlwZSBOb2RlUHVibGljU3RhdGU8VERhdGEgZXh0ZW5kcyBOb2RlRGF0YT4gPSBSZWFkb25seTx7XHJcbiAgZGF0YTogVERhdGE7XHJcbiAgc2V0T3BlbjogKHN0YXRlOiBib29sZWFuKSA9PiBQcm9taXNlPHZvaWQ+O1xyXG59PiAmIHtcclxuICBpc09wZW46IGJvb2xlYW47XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBOb2RlUmVjb3JkPFROb2RlUHVibGljU3RhdGUgZXh0ZW5kcyBOb2RlUHVibGljU3RhdGU8YW55Pj4gPVxyXG4gIFJlYWRvbmx5PHtcclxuICAgIHB1YmxpYzogVE5vZGVQdWJsaWNTdGF0ZTtcclxuICB9PiAmIHtcclxuICAgIGNoaWxkOiBOb2RlUmVjb3JkPFROb2RlUHVibGljU3RhdGU+IHwgbnVsbDtcclxuICAgIGlzU2hvd246IGJvb2xlYW47XHJcbiAgICBwYXJlbnQ6IE5vZGVSZWNvcmQ8VE5vZGVQdWJsaWNTdGF0ZT4gfCBudWxsO1xyXG4gICAgc2libGluZzogTm9kZVJlY29yZDxUTm9kZVB1YmxpY1N0YXRlPiB8IG51bGw7XHJcbiAgICB2aXNpdGVkOiBib29sZWFuO1xyXG4gIH07XHJcblxyXG5leHBvcnQgdHlwZSBOb2RlQ29tcG9uZW50UHJvcHM8XHJcbiAgVERhdGEgZXh0ZW5kcyBOb2RlRGF0YSxcclxuICBUTm9kZVB1YmxpY1N0YXRlIGV4dGVuZHMgTm9kZVB1YmxpY1N0YXRlPFREYXRhPlxyXG4+ID0gUmVhZG9ubHk8XHJcbiAgT21pdDxMaXN0Q2hpbGRDb21wb25lbnRQcm9wcywgJ2RhdGEnIHwgJ2luZGV4Jz4gJlxyXG4gICAgVE5vZGVQdWJsaWNTdGF0ZSAmIHtcclxuICAgICAgLyoqXHJcbiAgICAgICAqIFRoZSBkYXRhIHByb3ZpZGVkIGJ5IHVzZXIgdmlhIGBpdGVtRGF0YWAgVHJlZSBjb21wb25lbnQgcHJvcGVydHkuXHJcbiAgICAgICAqL1xyXG4gICAgICB0cmVlRGF0YT86IGFueTtcclxuICAgIH1cclxuPjtcclxuXHJcbmV4cG9ydCB0eXBlIFRyZWVXYWxrZXI8VERhdGEgZXh0ZW5kcyBOb2RlRGF0YSwgVE1ldGEgPSB7fT4gPSAoKSA9PiBHZW5lcmF0b3I8XHJcbiAgVHJlZVdhbGtlclZhbHVlPFREYXRhLCBUTWV0YT4gfCB1bmRlZmluZWQsXHJcbiAgdW5kZWZpbmVkLFxyXG4gIFRyZWVXYWxrZXJWYWx1ZTxURGF0YSwgVE1ldGE+XHJcbj47XHJcblxyXG5leHBvcnQgdHlwZSBPcGVubmVzc1N0YXRlPFxyXG4gIFREYXRhIGV4dGVuZHMgTm9kZURhdGEsXHJcbiAgVE5vZGVQdWJsaWNTdGF0ZSBleHRlbmRzIE5vZGVQdWJsaWNTdGF0ZTxURGF0YT5cclxuPiA9IFJlYWRvbmx5PFxyXG4gIFJlY29yZDxzdHJpbmcsIE9wZW5uZXNzU3RhdGVVcGRhdGVSdWxlczxURGF0YSwgVE5vZGVQdWJsaWNTdGF0ZT4gfCBib29sZWFuPlxyXG4+O1xyXG5cclxuZXhwb3J0IHR5cGUgVHJlZUNvbXB1dGVyUHJvcHM8VERhdGEgZXh0ZW5kcyBOb2RlRGF0YT4gPSBSZWFkb25seTx7XHJcbiAgYXN5bmM/OiBib29sZWFuO1xyXG4gIGJ1aWxkaW5nVGFza1RpbWVvdXQ/OiBudW1iZXI7XHJcbiAgcGxhY2Vob2xkZXI/OiBSZWFjdE5vZGU7XHJcbiAgdHJlZVdhbGtlcjogVHJlZVdhbGtlcjxURGF0YT47XHJcbn0+O1xyXG5cclxuZXhwb3J0IHR5cGUgVHJlZUNvbXB1dGVyU3RhdGU8XHJcbiAgVERhdGEgZXh0ZW5kcyBOb2RlRGF0YSxcclxuICBUTm9kZVB1YmxpY1N0YXRlIGV4dGVuZHMgTm9kZVB1YmxpY1N0YXRlPFREYXRhPlxyXG4+ID0gUmVhZG9ubHk8e1xyXG4gIG9yZGVyPzogc3RyaW5nW107XHJcbiAgcmVjb3JkczogUmVhZG9ubHlNYXA8c3RyaW5nIHwgc3ltYm9sLCBOb2RlUmVjb3JkPFROb2RlUHVibGljU3RhdGU+PjtcclxuICBzZXRTdGF0ZTogQ29tcG9uZW50PFxyXG4gICAgYW55LFxyXG4gICAgVHJlZUNvbXB1dGVyU3RhdGU8VERhdGEsIFROb2RlUHVibGljU3RhdGU+XHJcbiAgPlsnc2V0U3RhdGUnXTtcclxuICAvLyBBIHNpbXBsZSBoYWNrIHRvIGdldCBvdmVyIHRoZSBQdXJlQ29tcG9uZW50IHNoYWxsb3cgY29tcGFyaXNvblxyXG4gIHVwZGF0ZVJlcXVlc3Q6IG9iamVjdDtcclxufT47XHJcblxyXG5leHBvcnQgdHlwZSBUcmVlUHJvcHM8XHJcbiAgVERhdGEgZXh0ZW5kcyBOb2RlRGF0YSxcclxuICBUTm9kZVB1YmxpY1N0YXRlIGV4dGVuZHMgTm9kZVB1YmxpY1N0YXRlPFREYXRhPixcclxuICBUTGlzdENvbXBvbmVudCBleHRlbmRzIEZpeGVkU2l6ZUxpc3QgfCBWYXJpYWJsZVNpemVMaXN0XHJcbj4gPSBSZWFkb25seTxPbWl0PExpc3RQcm9wcywgJ2NoaWxkcmVuJyB8ICdpdGVtQ291bnQnIHwgJ2l0ZW1LZXknPj4gJlxyXG4gIFRyZWVDb21wdXRlclByb3BzPFREYXRhPiAmXHJcbiAgUmVhZG9ubHk8e1xyXG4gICAgY2hpbGRyZW46IENvbXBvbmVudFR5cGU8Tm9kZUNvbXBvbmVudFByb3BzPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPj47XHJcbiAgICBsaXN0UmVmPzogUmVmPFRMaXN0Q29tcG9uZW50PjtcclxuICAgIHJvd0NvbXBvbmVudD86IENvbXBvbmVudFR5cGU8TGlzdENoaWxkQ29tcG9uZW50UHJvcHM+O1xyXG4gIH0+O1xyXG5cclxuZXhwb3J0IHR5cGUgVHJlZVN0YXRlPFxyXG4gIFREYXRhIGV4dGVuZHMgTm9kZURhdGEsXHJcbiAgVE5vZGVQdWJsaWNTdGF0ZSBleHRlbmRzIE5vZGVQdWJsaWNTdGF0ZTxURGF0YT4sXHJcbiAgVExpc3RDb21wb25lbnQgZXh0ZW5kcyBGaXhlZFNpemVMaXN0IHwgVmFyaWFibGVTaXplTGlzdFxyXG4+ID0gVHJlZUNvbXB1dGVyU3RhdGU8VERhdGEsIFROb2RlUHVibGljU3RhdGU+ICZcclxuICBSZWFkb25seTx7XHJcbiAgICBhdHRhY2hSZWZzOiBSZWZDYWxsYmFjazxUTGlzdENvbXBvbmVudD47XHJcbiAgICBjb21wdXRlVHJlZTogVHJlZUNvbXB1dGVyPGFueSwgYW55LCBhbnksIGFueT47XHJcbiAgICBsaXN0OiBSZWZPYmplY3Q8VExpc3RDb21wb25lbnQ+O1xyXG4gICAgcmVjb21wdXRlVHJlZTogKFxyXG4gICAgICBvcHRpb25zOiBPcGVubmVzc1N0YXRlPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPlxyXG4gICAgKSA9PiBQcm9taXNlPHZvaWQ+O1xyXG4gICAgdHJlZVdhbGtlcjogVHJlZVdhbGtlcjxURGF0YT47XHJcbiAgfT47XHJcblxyXG5leHBvcnQgdHlwZSBUeXBlZExpc3RDaGlsZENvbXBvbmVudERhdGE8XHJcbiAgVERhdGEgZXh0ZW5kcyBOb2RlRGF0YSxcclxuICBUTm9kZVB1YmxpY1N0YXRlIGV4dGVuZHMgTm9kZVB1YmxpY1N0YXRlPFREYXRhPlxyXG4+ID0gUmVhZG9ubHk8e1xyXG4gIC8qKlxyXG4gICAqIFRoZSBOb2RlIGNvbXBvbmVudCBwcm92aWRlZCBieSB0aGUgdXNlci5cclxuICAgKi9cclxuICBjb21wb25lbnQ6IENvbXBvbmVudFR5cGU8Tm9kZUNvbXBvbmVudFByb3BzPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPj47XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBmdW5jdGlvbiB0aGF0IHJldHVybnMgcHVibGljIGRhdGEgZnJvbSB2aXNpYmxlIHJlY29yZHMgYnkgaW5kZXguXHJcbiAgICpcclxuICAgKiBAcGFyYW0gaW5kZXhcclxuICAgKi9cclxuICBnZXRSZWNvcmREYXRhOiAoaW5kZXg6IG51bWJlcikgPT4gVE5vZGVQdWJsaWNTdGF0ZTtcclxuXHJcbiAgLyoqXHJcbiAgICogQHNlZSBOb2RlQ29tcG9uZW50UHJvcHMjdHJlZURhdGFcclxuICAgKi9cclxuICB0cmVlRGF0YTogYW55O1xyXG59PjtcclxuXHJcbmV4cG9ydCB0eXBlIFR5cGVkTGlzdENoaWxkQ29tcG9uZW50UHJvcHM8XHJcbiAgVERhdGEgZXh0ZW5kcyBOb2RlRGF0YSxcclxuICBUTm9kZVB1YmxpY1N0YXRlIGV4dGVuZHMgTm9kZVB1YmxpY1N0YXRlPFREYXRhPlxyXG4+ID0gUmVhZG9ubHk8XHJcbiAgT21pdDxMaXN0Q2hpbGRDb21wb25lbnRQcm9wcywgJ2RhdGEnPiAmIHtcclxuICAgIGRhdGE6IFR5cGVkTGlzdENoaWxkQ29tcG9uZW50RGF0YTxURGF0YSwgVE5vZGVQdWJsaWNTdGF0ZT47XHJcbiAgfVxyXG4+O1xyXG5cclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvbixAdHlwZXNjcmlwdC1lc2xpbnQvcHJlZmVyLXJlYWRvbmx5LXBhcmFtZXRlci10eXBlc1xyXG5leHBvcnQgY29uc3QgUm93ID0gPFxyXG4gIFREYXRhIGV4dGVuZHMgTm9kZURhdGEsXHJcbiAgVE5vZGVQdWJsaWNTdGF0ZSBleHRlbmRzIE5vZGVQdWJsaWNTdGF0ZTxURGF0YT5cclxuPih7XHJcbiAgaW5kZXgsXHJcbiAgZGF0YTogeyBjb21wb25lbnQ6IE5vZGUsIGdldFJlY29yZERhdGEsIHRyZWVEYXRhIH0sXHJcbiAgc3R5bGUsXHJcbiAgaXNTY3JvbGxpbmcsXHJcbn06IFByb3BzV2l0aENoaWxkcmVuPFxyXG4gIFR5cGVkTGlzdENoaWxkQ29tcG9uZW50UHJvcHM8VERhdGEsIFROb2RlUHVibGljU3RhdGU+XHJcbj4pOiBSZWFjdEVsZW1lbnQgfCBudWxsID0+IHtcclxuICBjb25zdCBkYXRhID0gZ2V0UmVjb3JkRGF0YShpbmRleCk7XHJcblxyXG4gIHJldHVybiAoXHJcbiAgICA8Tm9kZVxyXG4gICAgICBpc1Njcm9sbGluZz17aXNTY3JvbGxpbmd9XHJcbiAgICAgIHN0eWxlPXtzdHlsZX1cclxuICAgICAgdHJlZURhdGE9e3RyZWVEYXRhfVxyXG4gICAgICB7Li4uZGF0YX1cclxuICAgIC8+XHJcbiAgKTtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFRyZWVDcmVhdG9yT3B0aW9uczxcclxuICBURGF0YSBleHRlbmRzIE5vZGVEYXRhLFxyXG4gIFROb2RlUHVibGljU3RhdGUgZXh0ZW5kcyBOb2RlUHVibGljU3RhdGU8VERhdGE+LFxyXG4gIFRTdGF0ZSBleHRlbmRzIFRyZWVDb21wdXRlclN0YXRlPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPlxyXG4+ID0gUmVhZG9ubHk8e1xyXG4gIGNyZWF0ZVJlY29yZDogKFxyXG4gICAgZGF0YTogVERhdGEsXHJcbiAgICBzdGF0ZTogVFN0YXRlLFxyXG4gICAgcGFyZW50PzogTm9kZVJlY29yZDxUTm9kZVB1YmxpY1N0YXRlPiB8IG51bGwsXHJcbiAgICBwcmV2aW91c1JlY29yZD86IE5vZGVSZWNvcmQ8VE5vZGVQdWJsaWNTdGF0ZT5cclxuICApID0+IE5vZGVSZWNvcmQ8VE5vZGVQdWJsaWNTdGF0ZT47XHJcbn0+O1xyXG5cclxuZXhwb3J0IHR5cGUgVHJlZUNvbXB1dGVyT3B0aW9uczxcclxuICBURGF0YSBleHRlbmRzIE5vZGVEYXRhLFxyXG4gIFROb2RlUHVibGljU3RhdGUgZXh0ZW5kcyBOb2RlUHVibGljU3RhdGU8VERhdGE+XHJcbj4gPSBSZWFkb25seTx7XHJcbiAgb3Blbm5lc3NTdGF0ZT86IE9wZW5uZXNzU3RhdGU8VERhdGEsIFROb2RlUHVibGljU3RhdGU+O1xyXG4gIHJlZnJlc2g/OiBib29sZWFuO1xyXG59PjtcclxuXHJcbmV4cG9ydCB0eXBlIFRyZWVDb21wdXRlcjxcclxuICBURGF0YSBleHRlbmRzIE5vZGVEYXRhLFxyXG4gIFROb2RlUHVibGljU3RhdGUgZXh0ZW5kcyBOb2RlUHVibGljU3RhdGU8VERhdGE+LFxyXG4gIFRQcm9wcyBleHRlbmRzIFRyZWVDb21wdXRlclByb3BzPFREYXRhPixcclxuICBUU3RhdGUgZXh0ZW5kcyBUcmVlQ29tcHV0ZXJTdGF0ZTxURGF0YSwgVE5vZGVQdWJsaWNTdGF0ZT5cclxuPiA9IChcclxuICBwcm9wczogVFByb3BzLFxyXG4gIHN0YXRlOiBUU3RhdGUsXHJcbiAgb3B0aW9uczogVHJlZUNvbXB1dGVyT3B0aW9uczxURGF0YSwgVE5vZGVQdWJsaWNTdGF0ZT5cclxuKSA9PlxyXG4gIHwgKFBpY2s8VFN0YXRlLCAnb3JkZXInIHwgJ3JlY29yZHMnPiAmIFBhcnRpYWw8UGljazxUU3RhdGUsICd1cGRhdGVSZXF1ZXN0Jz4+KVxyXG4gIHwgbnVsbDtcclxuXHJcbi8vIElmIHJlZnJlc2ggaXMgcmVxdWlyZWQsIHdlIHdpbGwgcnVuIHRoZSBUcmVlV2Fsa2VyLiBJdCB3aWxsIGNvbXBsZXRlbHlcclxuLy8gdXBkYXRlIGFsbCByZXF1ZXN0cyBhbmQgcmVzZXQgZXZlcnkgc3RhdGUgdG8gZGVmYXVsdC5cclxuY29uc3QgZ2VuZXJhdGVOZXdUcmVlID0gPFxyXG4gIFREYXRhIGV4dGVuZHMgTm9kZURhdGEsXHJcbiAgVE5vZGVQdWJsaWNTdGF0ZSBleHRlbmRzIE5vZGVQdWJsaWNTdGF0ZTxURGF0YT4sXHJcbiAgVFByb3BzIGV4dGVuZHMgVHJlZUNvbXB1dGVyUHJvcHM8VERhdGE+LFxyXG4gIFRTdGF0ZSBleHRlbmRzIFRyZWVDb21wdXRlclN0YXRlPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPlxyXG4+KFxyXG4gIHsgY3JlYXRlUmVjb3JkIH06IFRyZWVDcmVhdG9yT3B0aW9uczxURGF0YSwgVE5vZGVQdWJsaWNTdGF0ZSwgVFN0YXRlPixcclxuICB7IGJ1aWxkaW5nVGFza1RpbWVvdXQsIHBsYWNlaG9sZGVyLCBhc3luYyA9IGZhbHNlLCB0cmVlV2Fsa2VyIH06IFRQcm9wcyxcclxuICBzdGF0ZTogVFN0YXRlXHJcbik6IFJldHVyblR5cGU8VHJlZUNvbXB1dGVyPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlLCBUUHJvcHMsIFRTdGF0ZT4+ID0+IHtcclxuICBjb25zdCBzaG91bGRQcmVzZXJ2ZVByZXZpb3VzU3RhdGUgPVxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bm5lY2Vzc2FyeS1jb25kaXRpb25cclxuICAgIGFzeW5jICYmIHN0YXRlLnJlY29yZHMgIT09IHVuZGVmaW5lZDtcclxuICBjb25zdCB7IHJlY29yZHM6IHByZXZpb3VzUmVjb3JkcyB9ID0gc3RhdGU7XHJcblxyXG4gIGNvbnN0IG9yZGVyOiBzdHJpbmdbXSA9IFtdO1xyXG4gIGNvbnN0IHJlY29yZHMgPSBuZXcgTWFwPHN0cmluZyB8IHN5bWJvbCwgTm9kZVJlY29yZDxUTm9kZVB1YmxpY1N0YXRlPj4oKTtcclxuICBjb25zdCByZXF1ZXN0SWRsZUNhbGxiYWNrT3B0aW9ucyA9IGJ1aWxkaW5nVGFza1RpbWVvdXRcclxuICAgID8geyB0aW1lb3V0OiBidWlsZGluZ1Rhc2tUaW1lb3V0IH1cclxuICAgIDogdW5kZWZpbmVkO1xyXG5cclxuICBjb25zdCBtZXRhID0gbmV3IFdlYWtNYXA8XHJcbiAgICBOb2RlUmVjb3JkPFROb2RlUHVibGljU3RhdGU+LFxyXG4gICAgVHJlZVdhbGtlclZhbHVlPFREYXRhPlxyXG4gID4oKTtcclxuXHJcbiAgY29uc3QgaXRlciA9IHRyZWVXYWxrZXIoKTtcclxuICBjb25zdCB7IHZhbHVlOiByb290IH0gPSBpdGVyLm5leHQoKTtcclxuXHJcbiAgLy8gRWFjaCByZWNvcmQgaGFzIGEgbGluayB0byBhIHBhcmVudCwgdGhlIG5leHQgc2libGluZyBhbmQgdGhlIG5leHQgY2hpbGQuXHJcbiAgLy8gSGF2aW5nIHRoaXMgaW5mbywgd2UgY2FuIHBlcmZvcm0gYSBkZXB0aC1maXJzdCB0cmF2ZXJzZS5cclxuICBjb25zdCByb290UmVjb3JkID0gY3JlYXRlUmVjb3JkKFxyXG4gICAgcm9vdCEuZGF0YSxcclxuICAgIHN0YXRlLFxyXG4gICAgdW5kZWZpbmVkLFxyXG4gICAgc2hvdWxkUHJlc2VydmVQcmV2aW91c1N0YXRlID8gcHJldmlvdXNSZWNvcmRzLmdldChyb290IS5kYXRhLmlkKSA6IHVuZGVmaW5lZFxyXG4gICk7XHJcbiAgcmVjb3Jkcy5zZXQocm9vdFJlY29yZC5wdWJsaWMuZGF0YS5pZCwgcm9vdFJlY29yZCk7XHJcbiAgbWV0YS5zZXQocm9vdFJlY29yZCwgcm9vdCEpO1xyXG5cclxuICBsZXQgY3VycmVudFJlY29yZDogTm9kZVJlY29yZDxUTm9kZVB1YmxpY1N0YXRlPiB8IG51bGwgPSByb290UmVjb3JkO1xyXG4gIGxldCBpc1RyYXZlcnNpbmdSb290ID0gdHJ1ZTtcclxuICBsZXQgdGVtcFJlY29yZDogTm9kZVJlY29yZDxUTm9kZVB1YmxpY1N0YXRlPiB8IG51bGwgPSByb290UmVjb3JkO1xyXG5cclxuICBjb25zdCB1c2VJZGxlQ2FsbGJhY2sgPVxyXG4gICAgdHlwZW9mIHJlcXVlc3RJZGxlQ2FsbGJhY2sgIT09ICd1bmRlZmluZWQnICYmXHJcbiAgICBwbGFjZWhvbGRlciAhPT0gdW5kZWZpbmVkICYmXHJcbiAgICAvLyBJZiBwbGFjZWhvbGRlciBpcyBzZXQgdG8gbnVsbCBhbmQgdGhpcyBpcyB0aGUgZmlyc3QgYnVpbGQsIGlkbGUgY2FsbGJhY2tcclxuICAgIC8vIHdvbid0IGJlIHVzZWQuIEl0IGlzIG5lY2Vzc2FyeSBmb3IgdHJlZXMgd2l0aCBhc3luYyBkYXRhIHdoaWNoIGNhbiBiZVxyXG4gICAgLy8gZXh0cmVtZWx5IGNvbXBsZXggYnV0IHRoZSBmaXJzdCBidWlsZCBpcyBxdWl0ZSBlYXN5LiBEdXJpbmcgdGhlIGZvbGxvd2luZ1xyXG4gICAgLy8gaWRsZSBjYWxsYmFja3MgdGhlIG9sZCB0cmVlIHdpbGwgYmUgc2hvd24uXHJcbiAgICAhKHBsYWNlaG9sZGVyID09PSBudWxsICYmICFzdGF0ZS5vcmRlcik7XHJcblxyXG4gIGNvbnN0IGhhc1RpbWUgPSB1c2VJZGxlQ2FsbGJhY2tcclxuICAgID8gKGRlYWRsaW5lOiBSZXF1ZXN0SWRsZUNhbGxiYWNrRGVhZGxpbmUpID0+IGRlYWRsaW5lLnRpbWVSZW1haW5pbmcoKSA+IDBcclxuICAgIDogKCkgPT4gdHJ1ZTtcclxuXHJcbiAgY29uc3QgdGFzayA9IChkZWFkbGluZT86IFJlcXVlc3RJZGxlQ2FsbGJhY2tEZWFkbGluZSkgPT4ge1xyXG4gICAgd2hpbGUgKGN1cnJlbnRSZWNvcmQgIT09IG51bGwpIHtcclxuICAgICAgaWYgKCFoYXNUaW1lKGRlYWRsaW5lISkpIHtcclxuICAgICAgICByZXF1ZXN0SWRsZUNhbGxiYWNrKHRhc2ssIHJlcXVlc3RJZGxlQ2FsbGJhY2tPcHRpb25zKTtcclxuXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIWN1cnJlbnRSZWNvcmQudmlzaXRlZCkge1xyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5uZWNlc3NhcnktdHlwZS1hc3NlcnRpb25cclxuICAgICAgICBjb25zdCB7IHZhbHVlOiBjaGlsZCB9ID0gaXRlci5uZXh0KG1ldGEuZ2V0KGN1cnJlbnRSZWNvcmQpISk7XHJcblxyXG4gICAgICAgIC8vIFdoZW4gdGhlIGdlbmVyYXRvciByZXR1cm5zIHRoZSB1bmRlZmluZWQgdmFsdWUgd2UgY29uc2lkZXIgdGhhdCBhbGxcclxuICAgICAgICAvLyBjaGlsZHJlbiBhcmUgYWxyZWFkeSBzZW50IGFuZCB3ZSBuZWVkIHRvIHNlbGVjdCB0aGUgbmV3IHBhcmVudFxyXG4gICAgICAgIC8vIGVsZW1lbnQgdG8gZ2V0IGl0cyBjaGlsZHJlbi5cclxuICAgICAgICBpZiAoY2hpbGQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgaWYgKGlzVHJhdmVyc2luZ1Jvb3QpIHtcclxuICAgICAgICAgICAgaXNUcmF2ZXJzaW5nUm9vdCA9IGZhbHNlO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRSZWNvcmQuaXNTaG93bikge1xyXG4gICAgICAgICAgICAgIG9yZGVyLnB1c2goY3VycmVudFJlY29yZC5wdWJsaWMuZGF0YS5pZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGN1cnJlbnRSZWNvcmQudmlzaXRlZCA9IGN1cnJlbnRSZWNvcmQuY2hpbGQgIT09IG51bGw7XHJcblxyXG4gICAgICAgICAgICBjdXJyZW50UmVjb3JkID1cclxuICAgICAgICAgICAgICBjdXJyZW50UmVjb3JkLmNoaWxkICE9PSBudWxsXHJcbiAgICAgICAgICAgICAgICA/IGN1cnJlbnRSZWNvcmQuY2hpbGRcclxuICAgICAgICAgICAgICAgIDogY3VycmVudFJlY29yZC5zaWJsaW5nICE9PSBudWxsXHJcbiAgICAgICAgICAgICAgICA/IGN1cnJlbnRSZWNvcmQuc2libGluZ1xyXG4gICAgICAgICAgICAgICAgOiBjdXJyZW50UmVjb3JkLnBhcmVudDtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB0ZW1wUmVjb3JkID0gY3VycmVudFJlY29yZDtcclxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb250aW51ZVxyXG4gICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjaGlsZFJlY29yZCA9IGNyZWF0ZVJlY29yZChcclxuICAgICAgICAgIGNoaWxkLmRhdGEsXHJcbiAgICAgICAgICBzdGF0ZSxcclxuICAgICAgICAgIGlzVHJhdmVyc2luZ1Jvb3QgPyB1bmRlZmluZWQgOiBjdXJyZW50UmVjb3JkLFxyXG4gICAgICAgICAgc2hvdWxkUHJlc2VydmVQcmV2aW91c1N0YXRlXHJcbiAgICAgICAgICAgID8gcHJldmlvdXNSZWNvcmRzLmdldChjaGlsZC5kYXRhLmlkKVxyXG4gICAgICAgICAgICA6IHVuZGVmaW5lZFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmVjb3Jkcy5zZXQoY2hpbGRSZWNvcmQucHVibGljLmRhdGEuaWQsIGNoaWxkUmVjb3JkKTtcclxuICAgICAgICBtZXRhLnNldChjaGlsZFJlY29yZCwgY2hpbGQpO1xyXG5cclxuICAgICAgICBpZiAoIWlzVHJhdmVyc2luZ1Jvb3QgJiYgdGVtcFJlY29yZCA9PT0gY3VycmVudFJlY29yZCkge1xyXG4gICAgICAgICAgdGVtcFJlY29yZC5jaGlsZCA9IGNoaWxkUmVjb3JkO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0ZW1wUmVjb3JkIS5zaWJsaW5nID0gY2hpbGRSZWNvcmQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0ZW1wUmVjb3JkID0gY2hpbGRSZWNvcmQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY3VycmVudFJlY29yZC52aXNpdGVkID0gZmFsc2U7XHJcbiAgICAgICAgY3VycmVudFJlY29yZCA9XHJcbiAgICAgICAgICBjdXJyZW50UmVjb3JkLnNpYmxpbmcgIT09IG51bGxcclxuICAgICAgICAgICAgPyBjdXJyZW50UmVjb3JkLnNpYmxpbmdcclxuICAgICAgICAgICAgOiBjdXJyZW50UmVjb3JkLnBhcmVudDtcclxuICAgICAgICB0ZW1wUmVjb3JkID0gY3VycmVudFJlY29yZDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICh1c2VJZGxlQ2FsbGJhY2spIHtcclxuICAgICAgc3RhdGUuc2V0U3RhdGUoe1xyXG4gICAgICAgIG9yZGVyLFxyXG4gICAgICAgIHJlY29yZHMsXHJcbiAgICAgICAgdXBkYXRlUmVxdWVzdDoge30sXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGlmICh1c2VJZGxlQ2FsbGJhY2spIHtcclxuICAgIHJlcXVlc3RJZGxlQ2FsbGJhY2sodGFzaywgcmVxdWVzdElkbGVDYWxsYmFja09wdGlvbnMpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICB0YXNrKCk7XHJcbiAgfVxyXG5cclxuICAvLyBJZiB3ZSB3YW50IHRvIHByZXNlcnZlIHRoZSBwcmV2aW91cyBzdGF0ZSBhbmQgdXNlIHRoZSByZXF1ZXN0SWRsZUNhbGxiYWNrLFxyXG4gIC8vIHdlIG5lZWQgdG8gcmV0dXJuIHRoZSBvbGQgc3RhdGUuXHJcbiAgcmV0dXJuIHBsYWNlaG9sZGVyICE9PSB1bmRlZmluZWQgJiYgYXN5bmMgJiYgc3RhdGUub3JkZXJcclxuICAgID8gc3RhdGVcclxuICAgIDogeyBvcmRlciwgcmVjb3JkcyB9O1xyXG59O1xyXG5cclxuY29uc3QgTUFYX0ZVTkNUSU9OX0FSR1VNRU5UUyA9IDMyNzY4O1xyXG5jb25zdCBTUExJQ0VfREVGQVVMVF9BUkdVTUVOVFNfTlVNQkVSID0gMjtcclxuXHJcbi8vIElmIHdlIG5lZWQgdG8gcGVyZm9ybSBvbmx5IHRoZSB1cGRhdGUsIHRyZWVXYWxrZXIgd29uJ3QgYmUgdXNlZC4gVXBkYXRlIHdpbGxcclxuLy8gd29yayBpbnRlcm5hbGx5LCB0cmF2ZXJzaW5nIG9ubHkgdGhlIHN1YnRyZWUgb2YgZWxlbWVudHMgdGhhdCByZXF1aXJlXHJcbi8vIHVwZGF0ZSB0aHJvdWdoIHRoZSBvcGVubmVzc1N0YXRlIG9wdGlvbi5cclxuY29uc3QgdXBkYXRlRXhpc3RpbmdUcmVlID0gPFxyXG4gIFREYXRhIGV4dGVuZHMgTm9kZURhdGEsXHJcbiAgVE5vZGVQdWJsaWNTdGF0ZSBleHRlbmRzIE5vZGVQdWJsaWNTdGF0ZTxURGF0YT4sXHJcbiAgVFByb3BzIGV4dGVuZHMgVHJlZUNvbXB1dGVyUHJvcHM8VERhdGE+LFxyXG4gIFRTdGF0ZSBleHRlbmRzIFRyZWVDb21wdXRlclN0YXRlPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPlxyXG4+KFxyXG4gIHsgb3JkZXIsIHJlY29yZHMgfTogVFN0YXRlLFxyXG4gIHsgb3Blbm5lc3NTdGF0ZSB9OiBUcmVlQ29tcHV0ZXJPcHRpb25zPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPlxyXG4pOiBSZXR1cm5UeXBlPFRyZWVDb21wdXRlcjxURGF0YSwgVE5vZGVQdWJsaWNTdGF0ZSwgVFByb3BzLCBUU3RhdGU+PiA9PiB7XHJcbiAgaWYgKHR5cGVvZiBvcGVubmVzc1N0YXRlICE9PSAnb2JqZWN0Jykge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcclxuICBmb3IgKGNvbnN0IGlkIGluIG9wZW5uZXNzU3RhdGUpIHtcclxuICAgIGlmICghcmVjb3Jkcy5oYXMoaWQpKSB7XHJcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb250aW51ZVxyXG4gICAgICBjb250aW51ZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBvcHRzID0gb3Blbm5lc3NTdGF0ZVtpZF07XHJcbiAgICBjb25zdCBvd25lclJlY29yZCA9IHJlY29yZHMuZ2V0KGlkKSE7XHJcblxyXG4gICAgLy8gSGVyZSB3ZSB1bmlmeSB0aGUgc2hhcGUgb2Ygb3Blbm5lc3Mgc3RhdGUgb3B0aW9uc1xyXG4gICAgY29uc3Qge1xyXG4gICAgICBvcGVuLFxyXG4gICAgICBzdWJ0cmVlQ2FsbGJhY2sgPSBub29wLFxyXG4gICAgfTogT3Blbm5lc3NTdGF0ZVVwZGF0ZVJ1bGVzPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPiA9XHJcbiAgICAgIHR5cGVvZiBvcHRzID09PSAnYm9vbGVhbicgPyB7IG9wZW46IG9wdHMgfSA6IG9wdHM7XHJcblxyXG4gICAgbGV0IHVwZGF0ZTogKHJlY29yZDogTm9kZVJlY29yZDxUTm9kZVB1YmxpY1N0YXRlPikgPT4gdm9pZCA9IG5vb3A7XHJcbiAgICBsZXQgYXBwbHk6ICgpID0+IHZvaWQgPSBub29wO1xyXG5cclxuICAgIGlmIChvd25lclJlY29yZC5pc1Nob3duKSB7XHJcbiAgICAgIGlmIChvcGVuKSB7XHJcbiAgICAgICAgLy8gSWYgcmVjZWl2ZWQgcnVsZXMgcmVxdWlyZSB1cyB0byBvcGVuIHRoZSBzdWJ0cmVlLCB3ZSBoYXZlIDIgY2FzZXM6XHJcbiAgICAgICAgLy8gMS4gVGhlIG5vZGUgaXMgbm90IG9wZW5lZCB5ZXQuIEluIHRoaXMgY2FzZSB3ZSBzaW1wbHkgaGF2ZSB0b1xyXG4gICAgICAgIC8vIGNhbGN1bGF0ZSBhbmQgYWRkIG5ldyBpZHMuXHJcbiAgICAgICAgLy8gMi4gVGhlIG5vZGUgaXMgb3BlbmVkIGFscmVhZHkuIEluIHRoaXMgY2FzZSB3ZSBoYXZlIHRvIHJlbW92ZSBhbGxcclxuICAgICAgICAvLyBleGlzdGluZyBpZHMgYW5kIHJlcGxhY2UgdGhlbSB3aXRoIG5ldyBpZHMuXHJcblxyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gb3JkZXIhLmluZGV4T2YoaWQpO1xyXG5cclxuICAgICAgICAvLyBIZXJlIHdlIGNhbGN1bGF0ZSBhIGNvdW50IG9mIHZpc2libGUgc3VidHJlZSBub2RlcyB0byByZW1vdmUgZnJvbVxyXG4gICAgICAgIC8vIGBvcmRlcmAuIFRoZW4gd2Ugd2lsbCByZXBsYWNlIHRoZSBnYXAgd2l0aCB0aGUgdXBkYXRlZCBsaXN0IG9mXHJcbiAgICAgICAgLy8gc3VidHJlZSBub2Rlcy5cclxuICAgICAgICBsZXQgcmVjb3JkTmV4dFRvU3VidHJlZTogTm9kZVJlY29yZDxUTm9kZVB1YmxpY1N0YXRlPiB8IG51bGwgPVxyXG4gICAgICAgICAgb3duZXJSZWNvcmQ7XHJcblxyXG4gICAgICAgIHdoaWxlIChyZWNvcmROZXh0VG9TdWJ0cmVlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICBpZiAocmVjb3JkTmV4dFRvU3VidHJlZS5zaWJsaW5nICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJlY29yZE5leHRUb1N1YnRyZWUgPSByZWNvcmROZXh0VG9TdWJ0cmVlLnNpYmxpbmc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHJlY29yZE5leHRUb1N1YnRyZWUgPSByZWNvcmROZXh0VG9TdWJ0cmVlLnBhcmVudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNvdW50VG9SZW1vdmUgPVxyXG4gICAgICAgICAgcmVjb3JkTmV4dFRvU3VidHJlZSA9PT0gbnVsbFxyXG4gICAgICAgICAgICA/IG9yZGVyIS5sZW5ndGggLSAxIC0gaW5kZXhcclxuICAgICAgICAgICAgOiBvcmRlciEuaW5kZXhPZihyZWNvcmROZXh0VG9TdWJ0cmVlLnB1YmxpYy5kYXRhLmlkKSAtIDEgLSBpbmRleDtcclxuXHJcbiAgICAgICAgY29uc3Qgb3JkZXJQYXJ0czogQXJyYXk8QXJyYXk8bnVtYmVyIHwgc3RyaW5nIHwgc3ltYm9sPj4gPSBbXHJcbiAgICAgICAgICBbaW5kZXggKyAxLCBjb3VudFRvUmVtb3ZlXSxcclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICAvLyBVbmZvcnR1bmF0ZWx5LCBzcGxpY2UgY2Fubm90IHdvcmsgd2l0aCBiaWcgYXJyYXlzLiBJZiBhcnJheSBleGNlZWRzXHJcbiAgICAgICAgLy8gc29tZSBsZW5ndGggaXQgbWF5IGZpcmUgYW4gZXhjZXB0aW9uLiBUaGUgbGVuZ3RoIGlzIHNwZWNpZmljIGZvclxyXG4gICAgICAgIC8vIGVhY2ggZW5naW5lOyBlLmcuLCBNRE4gc2F5cyBhYm91dCA2NTUzNiBmb3IgV2Via2l0LiBTbywgdG8gYXZvaWQgdGhpc1xyXG4gICAgICAgIC8vIG92ZXJmbG93LCBJIHNwbGl0IGBvcmRlcmAgcGFydHMgdG8gY2h1bmtzIGJ5IDMyNzY4IGVsZW1lbnRzIGluIGVhY2hcclxuICAgICAgICAvLyBvbmUuIFRoZXNlIGNodW5rcyB3aWxsIGJlIHNlbnQgYXMgYXJndW1lbnRzIHRvIHRoZSBgc3BsaWNlYCBtZXRob2QuXHJcbiAgICAgICAgLy9cclxuICAgICAgICAvLyBUbyBhdm9pZCBhcnJheSBjb25jYXRlbmF0aW9ucyB3aGljaCBtYXkgY2F1c2UgTWFqb3IgR0MsIEkgc2V0IHR3b1xyXG4gICAgICAgIC8vIGZpcnN0IGFyZ3VtZW50cyBhcyBgc3BsaWNlYCdzIGBzdGFydGAgYW5kIGBkZWxldGVDb3VudGAgYXJndW1lbnRzLlxyXG4gICAgICAgIHVwZGF0ZSA9IChyZWNvcmQ6IE5vZGVSZWNvcmQ8VE5vZGVQdWJsaWNTdGF0ZT4pID0+IHtcclxuICAgICAgICAgIC8vIFdlIGhhdmUgdG8gY29uc2lkZXIgb25seSB0aGUgbmV3bHkgc2hvd24gZWxlbWVudHMgdGhhdCBhcmUgbm90IGluXHJcbiAgICAgICAgICAvLyB0aGUgb3JkZXIgbGlzdCB5ZXQuIFdlIHNob3VsZCBkbyBpdCBBRlRFUiB0aGUgdmlzaWJpbGl0eSB1cGRhdGVcclxuICAgICAgICAgIC8vIGhhcHBlbnMgYmVjYXVzZSBvdGhlcndpc2Ugd2Ugd29uJ3QgYmUgYWJsZSB0byBkaXN0aW5ndWlzaCBpZiB0aGVcclxuICAgICAgICAgIC8vIGVsZW1lbnQgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBvcmRlciBsaXN0LlxyXG5cclxuICAgICAgICAgIC8vIFVwZGF0ZSByZWNvcmQgdmlzaWJpbGl0eVxyXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXHJcbiAgICAgICAgICByZWNvcmQuaXNTaG93biA9IHJlY29yZC5wYXJlbnRcclxuICAgICAgICAgICAgPyByZWNvcmQucGFyZW50LnB1YmxpYy5pc09wZW4gJiYgcmVjb3JkLnBhcmVudC5pc1Nob3duXHJcbiAgICAgICAgICAgIDogdHJ1ZTtcclxuXHJcbiAgICAgICAgICBpZiAocmVjb3JkLmlzU2hvd24pIHtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudE9yZGVyUGFydCA9IG9yZGVyUGFydHNbb3JkZXJQYXJ0cy5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgY3VycmVudE9yZGVyUGFydC5wdXNoKHJlY29yZC5wdWJsaWMuZGF0YS5pZCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgY3VycmVudE9yZGVyUGFydC5sZW5ndGggPT09XHJcbiAgICAgICAgICAgICAgTUFYX0ZVTkNUSU9OX0FSR1VNRU5UUyArIFNQTElDRV9ERUZBVUxUX0FSR1VNRU5UU19OVU1CRVJcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgb3JkZXJQYXJ0cy5wdXNoKFtcclxuICAgICAgICAgICAgICAgIGluZGV4ICsgMSArIE1BWF9GVU5DVElPTl9BUkdVTUVOVFMgKiBvcmRlclBhcnRzLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhcHBseSA9ICgpID0+IHtcclxuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3JkZXJQYXJ0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yOiB0b28gZ2VuZXJpYyBmb3IgVFNcclxuICAgICAgICAgICAgb3JkZXIhLnNwbGljZSguLi5vcmRlclBhcnRzW2ldKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICB9IGVsc2UgaWYgKG93bmVyUmVjb3JkLnB1YmxpYy5pc09wZW4pIHtcclxuICAgICAgICAvLyBJZiByZWNlaXZlZCBydWxlcyByZXF1aXJlIHVzIHRvIGNsb3NlIHRoZSBzdWJ0cmVlLCB3ZSBoYXZlIHRvIHJlbW92ZVxyXG4gICAgICAgIC8vIGFsbCBzdWJ0cmVlIGlkcyBmcm9tIHRoZSBvcmRlciBsaXN0LlxyXG5cclxuICAgICAgICBjb25zdCBpbmRleCA9IG9yZGVyIS5pbmRleE9mKGlkKTtcclxuXHJcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcclxuXHJcbiAgICAgICAgdXBkYXRlID0gKHJlY29yZCkgPT4ge1xyXG4gICAgICAgICAgLy8gV2UgaGF2ZSB0byBjb25zaWRlciBvbmx5IGN1cnJlbnRseSB2aXNpYmxlIHN1YnRyZWUgbm9kZXMgQkVGT1JFXHJcbiAgICAgICAgICAvLyB0aGVpciB2aXNpYmlsaXR5IGlzIHVwZGF0ZWQuIE90aGVyd2lzZSB3ZSB3aWxsIGhhdmUgaW5jb3JyZWN0XHJcbiAgICAgICAgICAvLyBudW1iZXIgb2YgaXRlbXMgdG8gcmVtb3ZlOiB3ZSBjYW5ub3QgcmVtb3ZlIGVsZW1lbnRzIHRoYXQgYXJlIG5vdFxyXG4gICAgICAgICAgLy8gaW4gdGhlIG9yZGVyIGxpc3QuXHJcbiAgICAgICAgICAvL1xyXG4gICAgICAgICAgLy8gSWYgd2UgZG8gaXQgYWZ0ZXIgdGhlIHZpc2liaWxpdHkgdXBkYXRlLCB3ZSB3aWxsIGJlIHVuYWJsZSB0b1xyXG4gICAgICAgICAgLy8gdW5kZXJzdGFuZCBpZiB0aGUgZWxlbWVudCBpcyBzdGlsbCBpbiB0aGUgb3JkZXIgbGlzdC5cclxuICAgICAgICAgIGlmIChyZWNvcmQuaXNTaG93bikge1xyXG4gICAgICAgICAgICBjb3VudCArPSAxO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIFVwZGF0ZSByZWNvcmQgdmlzaWJpbGl0eVxyXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXHJcbiAgICAgICAgICByZWNvcmQuaXNTaG93biA9IHJlY29yZC5wYXJlbnRcclxuICAgICAgICAgICAgPyByZWNvcmQucGFyZW50LnB1YmxpYy5pc09wZW4gJiYgcmVjb3JkLnBhcmVudC5pc1Nob3duXHJcbiAgICAgICAgICAgIDogdHJ1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhcHBseSA9ICgpID0+IHtcclxuICAgICAgICAgIC8vIFJlbW92ZSBkYXRhIGFmdGVyIGVsZW1lbnQgd2l0aCBpbmRleFxyXG4gICAgICAgICAgb3JkZXIhLnNwbGljZShpbmRleCArIDEsIGNvdW50KTtcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGN1cnJlbnRSZWNvcmQ6IE5vZGVSZWNvcmQ8VE5vZGVQdWJsaWNTdGF0ZT4gfCBudWxsID0gb3duZXJSZWNvcmQ7XHJcblxyXG4gICAgd2hpbGUgKGN1cnJlbnRSZWNvcmQgIT09IG51bGwpIHtcclxuICAgICAgaWYgKCFjdXJyZW50UmVjb3JkLnZpc2l0ZWQpIHtcclxuICAgICAgICBjdXJyZW50UmVjb3JkLnB1YmxpYy5pc09wZW4gPVxyXG4gICAgICAgICAgY3VycmVudFJlY29yZCA9PT0gb3duZXJSZWNvcmQgPyBvcGVuIDogY3VycmVudFJlY29yZC5wdWJsaWMuaXNPcGVuO1xyXG5cclxuICAgICAgICBzdWJ0cmVlQ2FsbGJhY2soY3VycmVudFJlY29yZC5wdWJsaWMsIG93bmVyUmVjb3JkLnB1YmxpYyk7XHJcblxyXG4gICAgICAgIGlmIChjdXJyZW50UmVjb3JkICE9PSBvd25lclJlY29yZCkge1xyXG4gICAgICAgICAgdXBkYXRlKGN1cnJlbnRSZWNvcmQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3VycmVudFJlY29yZC52aXNpdGVkID0gY3VycmVudFJlY29yZC5jaGlsZCAhPT0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gVGhpcyBhbGdvcml0aG0gaXMgYSBiaXQgZGlmZmVyZW50IGZyb20gdGhlIHZpc2l0IGFsZ29yaXRobSBpbiB0aGVcclxuICAgICAgICAvLyB0cmVlIGdlbmVyYXRvci4gV2UgYXJlIHJlc3RyaWN0ZWQgd2l0aCB0aGUgYm91bmRzIG9mIGEgc3VidHJlZSBhbmRcclxuICAgICAgICAvLyBzaG91bGRuJ3QgZ28gb3ZlciBpdC4gU28gd2UgY2Fubm90IHNlYXJjaCBmb3IgdGhlIG93bmVyUmVjb3JkJ3NcclxuICAgICAgICAvLyBwYXJlbnQgb3Igc2libGluZyBiZWNhdXNlIGl0IHdpbGwgbGVhZCB1cyBvdXQgb2YgdGhlIHN1YnRyZWUuXHJcbiAgICAgICAgY3VycmVudFJlY29yZCA9XHJcbiAgICAgICAgICAvLyBMb29rIGZvciBjaGlsZCBpbiBhbnkgY2FzZVxyXG4gICAgICAgICAgY3VycmVudFJlY29yZC5jaGlsZCAhPT0gbnVsbFxyXG4gICAgICAgICAgICA/IGN1cnJlbnRSZWNvcmQuY2hpbGRcclxuICAgICAgICAgICAgOiAvLyBTdG9wIGxvb2tpbmcgZm9yIG5leHQgZWxlbWVudCBpZiBjdXJyZW50UmVjb3JkIGlzIHJvb3QuXHJcbiAgICAgICAgICAgIGN1cnJlbnRSZWNvcmQgPT09IG93bmVyUmVjb3JkXHJcbiAgICAgICAgICAgID8gbnVsbFxyXG4gICAgICAgICAgICA6IC8vIE90aGVyd2lzZSwgbG9vayBmb3Igc2libGluZyBvciBwYXJlbnRcclxuICAgICAgICAgICAgY3VycmVudFJlY29yZC5zaWJsaW5nICE9PSBudWxsXHJcbiAgICAgICAgICAgID8gY3VycmVudFJlY29yZC5zaWJsaW5nXHJcbiAgICAgICAgICAgIDogY3VycmVudFJlY29yZC5wYXJlbnQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY3VycmVudFJlY29yZC52aXNpdGVkID0gZmFsc2U7XHJcbiAgICAgICAgY3VycmVudFJlY29yZCA9XHJcbiAgICAgICAgICBjdXJyZW50UmVjb3JkID09PSBvd25lclJlY29yZFxyXG4gICAgICAgICAgICA/IG51bGxcclxuICAgICAgICAgICAgOiBjdXJyZW50UmVjb3JkLnNpYmxpbmcgIT09IG51bGxcclxuICAgICAgICAgICAgPyBjdXJyZW50UmVjb3JkLnNpYmxpbmdcclxuICAgICAgICAgICAgOiBjdXJyZW50UmVjb3JkLnBhcmVudDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFwcGx5KCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgb3JkZXIsXHJcbiAgICByZWNvcmRzLFxyXG4gICAgdXBkYXRlUmVxdWVzdDoge30sXHJcbiAgfTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVUcmVlQ29tcHV0ZXIgPVxyXG4gIDxcclxuICAgIFREYXRhIGV4dGVuZHMgTm9kZURhdGEsXHJcbiAgICBUTm9kZVB1YmxpY1N0YXRlIGV4dGVuZHMgTm9kZVB1YmxpY1N0YXRlPFREYXRhPixcclxuICAgIFRQcm9wcyBleHRlbmRzIFRyZWVDb21wdXRlclByb3BzPFREYXRhPixcclxuICAgIFRTdGF0ZSBleHRlbmRzIFRyZWVDb21wdXRlclN0YXRlPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPlxyXG4gID4oXHJcbiAgICBjcmVhdG9yT3B0aW9uczogVHJlZUNyZWF0b3JPcHRpb25zPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlLCBUU3RhdGU+XHJcbiAgKTogVHJlZUNvbXB1dGVyPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlLCBUUHJvcHMsIFRTdGF0ZT4gPT5cclxuICAocHJvcHMsIHN0YXRlLCBvcHRpb25zKSA9PlxyXG4gICAgb3B0aW9ucy5yZWZyZXNoXHJcbiAgICAgID8gZ2VuZXJhdGVOZXdUcmVlKGNyZWF0b3JPcHRpb25zLCBwcm9wcywgc3RhdGUpXHJcbiAgICAgIDogdXBkYXRlRXhpc3RpbmdUcmVlKHN0YXRlLCBvcHRpb25zKTtcclxuXHJcbmNsYXNzIFRyZWU8XHJcbiAgVERhdGEgZXh0ZW5kcyBOb2RlRGF0YSxcclxuICBUTm9kZVB1YmxpY1N0YXRlIGV4dGVuZHMgTm9kZVB1YmxpY1N0YXRlPFREYXRhPixcclxuICBUUHJvcHMgZXh0ZW5kcyBUcmVlUHJvcHM8VERhdGEsIFROb2RlUHVibGljU3RhdGUsIFRMaXN0Q29tcG9uZW50PixcclxuICBUU3RhdGUgZXh0ZW5kcyBUcmVlU3RhdGU8VERhdGEsIFROb2RlUHVibGljU3RhdGUsIFRMaXN0Q29tcG9uZW50PixcclxuICBUTGlzdENvbXBvbmVudCBleHRlbmRzIEZpeGVkU2l6ZUxpc3QgfCBWYXJpYWJsZVNpemVMaXN0XHJcbj4gZXh0ZW5kcyBQdXJlQ29tcG9uZW50PFRQcm9wcywgVFN0YXRlPiB7XHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L3N0YXRpYy1wcm9wZXJ0eS1wbGFjZW1lbnRcclxuICBwdWJsaWMgc3RhdGljIGRlZmF1bHRQcm9wczogUGFydGlhbDxEZWZhdWx0VHJlZVByb3BzPiA9IHtcclxuICAgIHJvd0NvbXBvbmVudDogUm93LFxyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzKFxyXG4gICAgcHJvcHM6IERlZmF1bHRUcmVlUHJvcHMsXHJcbiAgICBzdGF0ZTogRGVmYXVsdFRyZWVTdGF0ZVxyXG4gICk6IFBhcnRpYWw8RGVmYXVsdFRyZWVTdGF0ZT4gfCBudWxsIHtcclxuICAgIGNvbnN0IHsgbGlzdFJlZiA9IG51bGwsIHRyZWVXYWxrZXIgfSA9IHByb3BzO1xyXG4gICAgY29uc3QgeyBjb21wdXRlVHJlZSwgbGlzdCwgb3JkZXIsIHRyZWVXYWxrZXI6IG9sZFRyZWVXYWxrZXIgfSA9IHN0YXRlO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGF0dGFjaFJlZnM6IG1lcmdlUmVmcyhbbGlzdCwgbGlzdFJlZl0pLFxyXG4gICAgICAuLi4odHJlZVdhbGtlciAhPT0gb2xkVHJlZVdhbGtlciB8fCAhb3JkZXJcclxuICAgICAgICA/IGNvbXB1dGVUcmVlKHByb3BzLCBzdGF0ZSwgeyByZWZyZXNoOiB0cnVlIH0pXHJcbiAgICAgICAgOiBudWxsKSxcclxuICAgICAgdHJlZVdhbGtlcixcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IocHJvcHM6IFRQcm9wcywgY29udGV4dDogYW55KSB7XHJcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XHJcblxyXG4gICAgdGhpcy5nZXRSZWNvcmREYXRhID0gdGhpcy5nZXRSZWNvcmREYXRhLmJpbmQodGhpcyk7XHJcblxyXG4gICAgLyogZXNsaW50LWRpc2FibGUgcmVhY3Qvbm8tdW51c2VkLXN0YXRlLEB0eXBlc2NyaXB0LWVzbGludC9jb25zaXN0ZW50LXR5cGUtYXNzZXJ0aW9ucyAqL1xyXG4gICAgdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgbGlzdDogY3JlYXRlUmVmKCksXHJcbiAgICAgIHJlY29tcHV0ZVRyZWU6IHRoaXMucmVjb21wdXRlVHJlZS5iaW5kKHRoaXMpLFxyXG4gICAgICBzZXRTdGF0ZTogdGhpcy5zZXRTdGF0ZS5iaW5kKHRoaXMpLFxyXG4gICAgfSBhcyBUU3RhdGU7XHJcbiAgICAvKiBlc2xpbnQtZW5hYmxlIHJlYWN0L25vLXVudXNlZC1zdGF0ZSxAdHlwZXNjcmlwdC1lc2xpbnQvY29uc2lzdGVudC10eXBlLWFzc2VydGlvbnMgKi9cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRJdGVtRGF0YSgpOiBUeXBlZExpc3RDaGlsZENvbXBvbmVudERhdGE8VERhdGEsIFROb2RlUHVibGljU3RhdGU+IHtcclxuICAgIGNvbnN0IHsgY2hpbGRyZW46IGNvbXBvbmVudCwgaXRlbURhdGE6IHRyZWVEYXRhIH0gPSB0aGlzLnByb3BzO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGNvbXBvbmVudCxcclxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC91bmJvdW5kLW1ldGhvZFxyXG4gICAgICBnZXRSZWNvcmREYXRhOiB0aGlzLmdldFJlY29yZERhdGEsXHJcbiAgICAgIHRyZWVEYXRhLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBnZXRSZWNvcmREYXRhKGluZGV4OiBudW1iZXIpOiBUTm9kZVB1YmxpY1N0YXRlIHtcclxuICAgIGNvbnN0IHsgb3JkZXIsIHJlY29yZHMgfSA9IHRoaXMuc3RhdGU7XHJcblxyXG4gICAgcmV0dXJuIHJlY29yZHMuZ2V0KG9yZGVyIVtpbmRleF0pIS5wdWJsaWM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVjb21wdXRlVHJlZShcclxuICAgIHN0YXRlOiBPcGVubmVzc1N0YXRlPFREYXRhLCBUTm9kZVB1YmxpY1N0YXRlPlxyXG4gICk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGU8bmV2ZXI+KFxyXG4gICAgICAgIChwcmV2U3RhdGUpID0+XHJcbiAgICAgICAgICBwcmV2U3RhdGUuY29tcHV0ZVRyZWUodGhpcy5wcm9wcywgcHJldlN0YXRlLCB7XHJcbiAgICAgICAgICAgIG9wZW5uZXNzU3RhdGU6IHN0YXRlLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgcmVzb2x2ZVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2Nyb2xsVG8oc2Nyb2xsT2Zmc2V0OiBudW1iZXIpOiB2b2lkIHtcclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9kZXN0cnVjdHVyaW5nLWFzc2lnbm1lbnRcclxuICAgIHRoaXMuc3RhdGUubGlzdC5jdXJyZW50Py5zY3JvbGxUbyhzY3JvbGxPZmZzZXQpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNjcm9sbFRvSXRlbShpZDogc3RyaW5nLCBhbGlnbj86IEFsaWduKTogdm9pZCB7XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvZGVzdHJ1Y3R1cmluZy1hc3NpZ25tZW50XHJcbiAgICB0aGlzLnN0YXRlLmxpc3QuY3VycmVudD8uc2Nyb2xsVG9JdGVtKHRoaXMuc3RhdGUub3JkZXIhLmluZGV4T2YoaWQpLCBhbGlnbik7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBUcmVlO1xyXG4iLCJpbXBvcnQgeyBGaXhlZFNpemVMaXN0IH0gZnJvbSAncmVhY3Qtd2luZG93JztcclxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHR5cGUge1xyXG4gIE5vZGVEYXRhLFxyXG4gIE5vZGVQdWJsaWNTdGF0ZSxcclxuICBOb2RlUmVjb3JkLFxyXG4gIFRyZWVDcmVhdG9yT3B0aW9ucyxcclxuICBUcmVlUHJvcHMsXHJcbiAgVHJlZVN0YXRlLFxyXG4gIFR5cGVkTGlzdENoaWxkQ29tcG9uZW50RGF0YSxcclxufSBmcm9tICcuL1RyZWUnO1xyXG5cclxuZXhwb3J0IHR5cGUgTXV0YWJsZTxUPiA9IHtcclxuICAtcmVhZG9ubHkgW1AgaW4ga2V5b2YgVF06IFRbUF07XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBSZXF1ZXN0SWRsZUNhbGxiYWNrSGFuZGxlID0gYW55O1xyXG5cclxuZXhwb3J0IHR5cGUgUmVxdWVzdElkbGVDYWxsYmFja09wdGlvbnMgPSBSZWFkb25seTx7XHJcbiAgdGltZW91dDogbnVtYmVyO1xyXG59PjtcclxuXHJcbmV4cG9ydCB0eXBlIFJlcXVlc3RJZGxlQ2FsbGJhY2tEZWFkbGluZSA9IFJlYWRvbmx5PHtcclxuICBkaWRUaW1lb3V0OiBib29sZWFuO1xyXG4gIHRpbWVSZW1haW5pbmc6ICgpID0+IG51bWJlcjtcclxufT47XHJcblxyXG5leHBvcnQgdHlwZSBEZWZhdWx0VHJlZVByb3BzID0gVHJlZVByb3BzPFxyXG4gIE5vZGVEYXRhLFxyXG4gIE5vZGVQdWJsaWNTdGF0ZTxOb2RlRGF0YT4sXHJcbiAgRml4ZWRTaXplTGlzdFxyXG4+O1xyXG5cclxuZXhwb3J0IHR5cGUgRGVmYXVsdFRyZWVTdGF0ZSA9IFRyZWVTdGF0ZTxcclxuICBOb2RlRGF0YSxcclxuICBOb2RlUHVibGljU3RhdGU8Tm9kZURhdGE+LFxyXG4gIEZpeGVkU2l6ZUxpc3RcclxuPjtcclxuXHJcbmV4cG9ydCB0eXBlIERlZmF1bHRUcmVlQ3JlYXRvck9wdGlvbnMgPSBUcmVlQ3JlYXRvck9wdGlvbnM8XHJcbiAgTm9kZURhdGEsXHJcbiAgTm9kZVB1YmxpY1N0YXRlPE5vZGVEYXRhPixcclxuICBEZWZhdWx0VHJlZVN0YXRlXHJcbj47XHJcblxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWVtcHR5LWZ1bmN0aW9uXHJcbmV4cG9ydCBjb25zdCBub29wID0gKCk6IHZvaWQgPT4ge307XHJcblxyXG5leHBvcnQgY29uc3QgaWRlbnRpdHkgPSA8VD4odmFsdWU6IFQpOiBUID0+IHZhbHVlO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZUJhc2ljUmVjb3JkID0gPFxyXG4gIFREYXRhIGV4dGVuZHMgTm9kZURhdGEsXHJcbiAgVE5vZGVQdWJsaWNTdGF0ZSBleHRlbmRzIE5vZGVQdWJsaWNTdGF0ZTxURGF0YT5cclxuPihcclxuICBwdWI6IFROb2RlUHVibGljU3RhdGUsXHJcbiAgcGFyZW50OiBOb2RlUmVjb3JkPFROb2RlUHVibGljU3RhdGU+IHwgbnVsbCA9IG51bGxcclxuKTogTm9kZVJlY29yZDxUTm9kZVB1YmxpY1N0YXRlPiA9PiAoe1xyXG4gIGNoaWxkOiBudWxsLFxyXG4gIGlzU2hvd246IHBhcmVudCA/IHBhcmVudC5wdWJsaWMuaXNPcGVuICYmIHBhcmVudC5pc1Nob3duIDogdHJ1ZSxcclxuICBwYXJlbnQsXHJcbiAgcHVibGljOiBwdWIsXHJcbiAgc2libGluZzogbnVsbCxcclxuICB2aXNpdGVkOiBmYWxzZSxcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0SWRCeUluZGV4ID0gPFxyXG4gIFREYXRhIGV4dGVuZHMgTm9kZURhdGEsXHJcbiAgVE5vZGVQdWJsaWNTdGF0ZSBleHRlbmRzIE5vZGVQdWJsaWNTdGF0ZTxURGF0YT5cclxuPihcclxuICBpbmRleDogbnVtYmVyLFxyXG4gIHsgZ2V0UmVjb3JkRGF0YSB9OiBUeXBlZExpc3RDaGlsZENvbXBvbmVudERhdGE8VERhdGEsIFROb2RlUHVibGljU3RhdGU+XHJcbik6IHN0cmluZyA9PiB7XHJcbiAgY29uc3Qge1xyXG4gICAgZGF0YTogeyBpZCB9LFxyXG4gIH0gPSBnZXRSZWNvcmREYXRhKGluZGV4KTtcclxuXHJcbiAgcmV0dXJuIGlkO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IG1lcmdlUmVmcyA9XHJcbiAgPFQ+KFxyXG4gICAgcmVmczogQXJyYXk8UmVhY3QuTXV0YWJsZVJlZk9iamVjdDxUPiB8IFJlYWN0LkxlZ2FjeVJlZjxUPj5cclxuICApOiBSZWFjdC5SZWZDYWxsYmFjazxUPiA9PlxyXG4gICh2YWx1ZSkgPT4ge1xyXG4gICAgcmVmcy5mb3JFYWNoKChyZWYpID0+IHtcclxuICAgICAgaWYgKHR5cGVvZiByZWYgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICByZWYodmFsdWUpO1xyXG4gICAgICB9IGVsc2UgaWYgKHJlZiAhPSBudWxsKSB7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXHJcbiAgICAgICAgKHJlZiBhcyBSZWFjdC5NdXRhYmxlUmVmT2JqZWN0PFQgfCBudWxsPikuY3VycmVudCA9IHZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG4iLCJpbXBvcnQgUmVhY3QsIHsgUmVhY3ROb2RlIH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyBWYXJpYWJsZVNpemVMaXN0LCBWYXJpYWJsZVNpemVMaXN0UHJvcHMgfSBmcm9tICdyZWFjdC13aW5kb3cnO1xyXG5pbXBvcnQgVHJlZSwge1xyXG4gIGNyZWF0ZVRyZWVDb21wdXRlcixcclxuICBOb2RlRGF0YSxcclxuICBOb2RlUHVibGljU3RhdGUsXHJcbiAgT3Blbm5lc3NTdGF0ZSxcclxuICBUcmVlUHJvcHMsXHJcbiAgVHJlZVN0YXRlLFxyXG59IGZyb20gJy4vVHJlZSc7XHJcbmltcG9ydCB7IGNyZWF0ZUJhc2ljUmVjb3JkLCBnZXRJZEJ5SW5kZXggfSBmcm9tICcuL3V0aWxzJztcclxuXHJcbmV4cG9ydCB0eXBlIFZhcmlhYmxlU2l6ZU5vZGVEYXRhID0gUmVhZG9ubHk8e1xyXG4gIC8qKiBEZWZhdWx0IG5vZGUgaGVpZ2h0LiBDYW4gYmUgdXNlZCBvbmx5IHdpdGggVmFyaWFibGVTaXplVHJlZSAqL1xyXG4gIGRlZmF1bHRIZWlnaHQ6IG51bWJlcjtcclxufT4gJlxyXG4gIE5vZGVEYXRhO1xyXG5cclxuZXhwb3J0IHR5cGUgVmFyaWFibGVTaXplTm9kZVB1YmxpY1N0YXRlPFQgZXh0ZW5kcyBWYXJpYWJsZVNpemVOb2RlRGF0YT4gPVxyXG4gIE5vZGVQdWJsaWNTdGF0ZTxUPiAmIHtcclxuICAgIGhlaWdodDogbnVtYmVyO1xyXG4gICAgcmVhZG9ubHkgcmVzaXplOiAoaGVpZ2h0OiBudW1iZXIsIHNob3VsZEZvcmNlVXBkYXRlPzogYm9vbGVhbikgPT4gdm9pZDtcclxuICB9O1xyXG5cclxuZXhwb3J0IHR5cGUgVmFyaWFibGVTaXplVHJlZVByb3BzPFREYXRhIGV4dGVuZHMgVmFyaWFibGVTaXplTm9kZURhdGE+ID1cclxuICBUcmVlUHJvcHM8VERhdGEsIFZhcmlhYmxlU2l6ZU5vZGVQdWJsaWNTdGF0ZTxURGF0YT4sIFZhcmlhYmxlU2l6ZUxpc3Q+ICZcclxuICAgIFJlYWRvbmx5PHtcclxuICAgICAgaXRlbVNpemU/OiBWYXJpYWJsZVNpemVMaXN0UHJvcHNbJ2l0ZW1TaXplJ107XHJcbiAgICB9PjtcclxuXHJcbmV4cG9ydCB0eXBlIFZhcmlhYmxlU2l6ZVRyZWVTdGF0ZTxUIGV4dGVuZHMgVmFyaWFibGVTaXplTm9kZURhdGE+ID0gVHJlZVN0YXRlPFxyXG4gIFQsXHJcbiAgVmFyaWFibGVTaXplTm9kZVB1YmxpY1N0YXRlPFQ+LFxyXG4gIFZhcmlhYmxlU2l6ZUxpc3RcclxuPiAmXHJcbiAgUmVhZG9ubHk8e1xyXG4gICAgcmVzZXRBZnRlcklkOiAoaWQ6IHN0cmluZywgc2hvdWxkRm9yY2VVcGRhdGU/OiBib29sZWFuKSA9PiB2b2lkO1xyXG4gIH0+O1xyXG5cclxuY29uc3QgY29tcHV0ZVRyZWUgPSBjcmVhdGVUcmVlQ29tcHV0ZXI8XHJcbiAgVmFyaWFibGVTaXplTm9kZURhdGEsXHJcbiAgVmFyaWFibGVTaXplTm9kZVB1YmxpY1N0YXRlPFZhcmlhYmxlU2l6ZU5vZGVEYXRhPixcclxuICBWYXJpYWJsZVNpemVUcmVlUHJvcHM8VmFyaWFibGVTaXplTm9kZURhdGE+LFxyXG4gIFZhcmlhYmxlU2l6ZVRyZWVTdGF0ZTxWYXJpYWJsZVNpemVOb2RlRGF0YT5cclxuPih7XHJcbiAgY3JlYXRlUmVjb3JkOiAoXHJcbiAgICBkYXRhLFxyXG4gICAgeyByZWNvbXB1dGVUcmVlLCByZXNldEFmdGVySWQgfSxcclxuICAgIHBhcmVudCxcclxuICAgIHByZXZpb3VzUmVjb3JkXHJcbiAgKSA9PiB7XHJcbiAgICBjb25zdCByZWNvcmQgPSBjcmVhdGVCYXNpY1JlY29yZChcclxuICAgICAge1xyXG4gICAgICAgIGRhdGEsXHJcbiAgICAgICAgaGVpZ2h0OiBwcmV2aW91c1JlY29yZFxyXG4gICAgICAgICAgPyBwcmV2aW91c1JlY29yZC5wdWJsaWMuaGVpZ2h0XHJcbiAgICAgICAgICA6IGRhdGEuZGVmYXVsdEhlaWdodCxcclxuICAgICAgICBpc09wZW46IHByZXZpb3VzUmVjb3JkXHJcbiAgICAgICAgICA/IHByZXZpb3VzUmVjb3JkLnB1YmxpYy5pc09wZW5cclxuICAgICAgICAgIDogZGF0YS5pc09wZW5CeURlZmF1bHQsXHJcbiAgICAgICAgcmVzaXplOiAoaGVpZ2h0OiBudW1iZXIsIHNob3VsZEZvcmNlVXBkYXRlPzogYm9vbGVhbik6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgcmVjb3JkLnB1YmxpYy5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgICByZXNldEFmdGVySWQocmVjb3JkLnB1YmxpYy5kYXRhLmlkLCBzaG91bGRGb3JjZVVwZGF0ZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRPcGVuOiAoc3RhdGUpOiBQcm9taXNlPHZvaWQ+ID0+XHJcbiAgICAgICAgICByZWNvbXB1dGVUcmVlKHtcclxuICAgICAgICAgICAgW2RhdGEuaWRdOiBzdGF0ZSxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICB9LFxyXG4gICAgICBwYXJlbnRcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlY29yZDtcclxuICB9LFxyXG59KTtcclxuXHJcbmV4cG9ydCBjbGFzcyBWYXJpYWJsZVNpemVUcmVlPFREYXRhIGV4dGVuZHMgVmFyaWFibGVTaXplTm9kZURhdGE+IGV4dGVuZHMgVHJlZTxcclxuICBURGF0YSxcclxuICBWYXJpYWJsZVNpemVOb2RlUHVibGljU3RhdGU8VERhdGE+LFxyXG4gIFZhcmlhYmxlU2l6ZVRyZWVQcm9wczxURGF0YT4sXHJcbiAgVmFyaWFibGVTaXplVHJlZVN0YXRlPFREYXRhPixcclxuICBWYXJpYWJsZVNpemVMaXN0XHJcbj4ge1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcm9wczogVmFyaWFibGVTaXplVHJlZVByb3BzPFREYXRhPiwgY29udGV4dDogYW55KSB7XHJcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XHJcbiAgICB0aGlzLmdldEl0ZW1TaXplID0gdGhpcy5nZXRJdGVtU2l6ZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgLi4udGhpcy5zdGF0ZSxcclxuICAgICAgY29tcHV0ZVRyZWUsXHJcbiAgICAgIHJlc2V0QWZ0ZXJJZDogdGhpcy5yZXNldEFmdGVySWQuYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXRBZnRlcklkKGlkOiBzdHJpbmcsIHNob3VsZEZvcmNlVXBkYXRlOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgbGlzdCwgb3JkZXIgfSA9IHRoaXMuc3RhdGU7XHJcbiAgICBsaXN0LmN1cnJlbnQ/LnJlc2V0QWZ0ZXJJbmRleChvcmRlciEuaW5kZXhPZihpZCksIHNob3VsZEZvcmNlVXBkYXRlKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZWNvbXB1dGVUcmVlKFxyXG4gICAgc3RhdGU6IE9wZW5uZXNzU3RhdGU8VERhdGEsIFZhcmlhYmxlU2l6ZU5vZGVQdWJsaWNTdGF0ZTxURGF0YT4+XHJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gc3VwZXIucmVjb21wdXRlVHJlZShzdGF0ZSkudGhlbigoKSA9PiB7XHJcbiAgICAgIHRoaXMuc3RhdGUubGlzdC5jdXJyZW50Py5yZXNldEFmdGVySW5kZXgoMCwgdHJ1ZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZW5kZXIoKTogUmVhY3ROb2RlIHtcclxuICAgIGNvbnN0IHsgcGxhY2Vob2xkZXIsIGl0ZW1TaXplLCByb3dDb21wb25lbnQsIC4uLnJlc3QgfSA9IHRoaXMucHJvcHM7XHJcbiAgICBjb25zdCB7IGF0dGFjaFJlZnMsIG9yZGVyIH0gPSB0aGlzLnN0YXRlO1xyXG5cclxuICAgIHJldHVybiBwbGFjZWhvbGRlciAmJiBvcmRlciEubGVuZ3RoID09PSAwID8gKFxyXG4gICAgICBwbGFjZWhvbGRlclxyXG4gICAgKSA6IChcclxuICAgICAgPFZhcmlhYmxlU2l6ZUxpc3RcclxuICAgICAgICB7Li4ucmVzdH1cclxuICAgICAgICBpdGVtQ291bnQ9e29yZGVyIS5sZW5ndGh9XHJcbiAgICAgICAgaXRlbURhdGE9e3RoaXMuZ2V0SXRlbURhdGEoKX1cclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kXHJcbiAgICAgICAgaXRlbUtleT17Z2V0SWRCeUluZGV4fVxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvdW5ib3VuZC1tZXRob2RcclxuICAgICAgICBpdGVtU2l6ZT17aXRlbVNpemUgPz8gdGhpcy5nZXRJdGVtU2l6ZX1cclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kXHJcbiAgICAgICAgcmVmPXthdHRhY2hSZWZzfVxyXG4gICAgICA+XHJcbiAgICAgICAge3Jvd0NvbXBvbmVudCF9XHJcbiAgICAgIDwvVmFyaWFibGVTaXplTGlzdD5cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEl0ZW1TaXplKGluZGV4OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0UmVjb3JkRGF0YShpbmRleCkuaGVpZ2h0O1xyXG4gIH1cclxufVxyXG4iXX0=